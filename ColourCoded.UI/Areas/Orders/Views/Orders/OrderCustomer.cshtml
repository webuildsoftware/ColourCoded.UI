
@{
  ViewData["Title"] = "OrderCustomer";
  Layout = "~/Views/Shared/_Layout.cshtml";
}


<style>
  table thead tr td {
    background-color: lightgray;
    padding: 3px;
    font-weight: bold;
  }

  table tbody tr td {
    padding: 3px;
  }

  table i {
    cursor: pointer;
  }

  input[type=button] {
    width: 100px;
  }

  .validationLabel {
    color: red;
    width: 150px;
    font-size: 11px;
  }

  #main div {
    padding: 3px;
  }

    #main div span {
      font-size: 11px;
    }

  .orderno {
    width: 100px;
  }

  textarea {
    width: 175px;
    height: 70px;
  }
</style>
<h3 id="orderno" orderid></h3>
<div id="main">
  <div id="left" style="display: inline-block; width:300px">
    <fieldset>
      <legend>Customer Details</legend>
      <div>
        <span>Available Customers</span>
        <br />
        <select id="existingcustomers" style="width: 175px">
          <option value=""></option>
          <option value="1">City of Cape Town</option>
          <option value="2">False Bay College</option>
          <option value="3">PresLes</option>
        </select>
      </div>
      <div>
        <span>Customer Name</span>
        <br />
        <input type="text" id="customername" placeholder="Enter a short name" maxlength="10" />
      </div>
      <div>
        <span>Customer Details</span>
        <br />
        <textarea id="customerdetails">
        </textarea>
      </div>
      <div>
        <span>Customer Contact No</span>
        <br />
        <input type="text" id="customercontactno" placeholder="Enter a contact no" maxlength="10" />
      </div>
      <div>
        <span>Customer Account No</span>
        <br />
        <input type="text" id="customeraccountno" placeholder="Enter accountno (optional)" />
      </div>
      <div>
        <span>Customer Mobile No</span>
        <br />
        <input type="text" id="customermobileno" placeholder="Enter mobile no (optional)" maxlength="10" />
      </div>
      <div>
        <span>Customer Email</span>
        <br />
        <input type="text" id="customeremail" placeholder="Enter email (optional)" />
      </div>
    </fieldset>
  </div>
  <div id="right" style="display: inline-block; position:absolute">
    <fieldset id="panelContacts">
      <legend>Customer Contacts</legend>
      <div>
        <span>Available Contacts</span>
        <br />
        <select id="existingcontacts" style="width: 175px">
          <option value=""></option>
          <option value="1">Belinda</option>
          <option value="2">John Williams</option>
          <option value="3">Valencia</option>
        </select>
      </div>
      <div>
        <span>Contact Name</span>
        <br />
        <input type="text" id="contactname" placeholder="Enter any name" />
      </div>
      <div>
        <span>Contact No</span>
        <br />
        <input type="text" id="contactno" placeholder="Enter a contact no" maxlength="10" />
      </div>
      <div>
        <span>Contact Email</span>
        <br />
        <input type="text" id="contactemail" placeholder="Enter email (optional)" />
      </div>
      <div style="padding-top:10px">
        <input id="addcontact" value="Add Contact" type="button" />&nbsp;
        <input id="done" value="Done" type="button" />&nbsp;
        <label id="validbuttons" class="validationLabel"></label>
      </div>
      <br />
      <div id="divcontacts">
        <span>Selected Contact</span>
        <table id="contacts">
          <thead>
            <tr>
              <td>Name</td>
              <td>ContactNo</td>
              <td>EmailAddress</td>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <legend></legend>
    </fieldset>
  </div>

  @*

      <fieldset id="panelAddress">
      <legend>Address Details</legend>
      <div>
        <span>Address Type</span>
        <br />
        <select id="addresstype">
          <option value="Home">Home</option>
          <option value="Business">Business</option>
          <option value="Delivery">Delivery</option>
        </select>
      </div>
      <div style="display: inline-block">
        <span>Line 1</span>
        <br />
        <input type="text" id="addressline1" placeholder="Enter unit/street no" />
      </div>
      <br />
      <div style="display: inline-block; width: 200px">
        <span>Line 2</span>
        <br />
        <input type="text" id="addressline2" placeholder="Enter suburb" />
      </div>
      <div style="display: inline-block">
        <span>City</span>
        <br />
        <input type="text" id="addresscity" placeholder="Enter city" />
      </div>
      <br />
      <div style="display: inline-block; width: 200px">
        <span>Country</span>
        <br />
        <select id="addresscountry">
          <option value="RSA">Republic of South Africa</option>
        </select>
      </div>
      <div style="display: inline-block">
        <span>Postal Code</span>
        <br />
        <input type="text" id="addresspostalcode" placeholder="Enter postal code" />
      </div>
      <br />
      <div id="divaddressdetails">
        <span>Address Details</span>
        <table id="addressdetails">
          <thead>
            <tr>
              <td>Type</td>
              <td>Line1</td>
              <td>Line2</td>
              <td>City</td>
              <td>Country</td>
              <td>Postal</td>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </fieldset>*@
</div>
@section Scripts{
  <script>
    var queryString = location.href.split("?")[1];
    var orderId = 0;
    var orderNo = "";
    var order = {
      "customerContacts": [],
      "addContacts": [],
      "customers": [],
    };

    $(document).ready(function () {
      $("#customerdetails").html("");

      if (queryString != undefined) {
        // get order id from query string
        orderId = queryString.split("&")[0].split("=")[1];
        orderNo = queryString.split("&")[1].split("=")[1];

        $("#orderno").html("Order: " + orderNo);
        $("#orderno").attr("orderid", orderId);
      }

      $("#divcontacts").hide();
    });

    $("#customercontactno").keyup(function (event) {
      var quantity = $(this).val();

      if (!$.isNumeric(event.key))
        $(this).val(quantity.replace(event.key, ""));

    });

    $("#customercontactno").change(function (event) {
      if (!$.isNumeric($(this).val()))
        $(this).val("");
    });

    $("#customermobileno").keyup(function (event) {
      var quantity = $(this).val();

      if (!$.isNumeric(event.key))
        $(this).val(quantity.replace(event.key, ""));

    });

    $("#customermobileno").change(function (event) {
      if (!$.isNumeric($(this).val()))
        $(this).val("");
    });

    $("#contactno").keyup(function (event) {
      var quantity = $(this).val();

      if (!$.isNumeric(event.key))
        $(this).val(quantity.replace(event.key, ""));

      if (event.keyCode == 13) { $("#addcontact").click(); }
    });

    $("#contactno").change(function (event) {
      if (!$.isNumeric($(this).val()))
        $(this).val("");
    });

    function validateEmail(email) {
      var pattern = /^[a-zA-Z0-9\-_]+(\.[a-zA-Z0-9\-_]+)*@@[a-z0-9]+(\-[a-z0-9]+)*(\.[a-z0-9]+(\-[a-z0-9]+)*)*\.[a-z]{2,4}$/;
      return pattern.test(email);
    }

    $("#customeremail").change(function (event) {
      var emailAddress = $(this).val();

      if (!validateEmail(emailAddress) && emailAddress != "") {
        $(this).addClass("alert-danger");
        $(this).attr("placeholder", "Enter valid email");
      }
    });

    $("#customeremail").keyup(function (event) {
      $(this).removeClass();

    });

    $("#contactemail").change(function (event) {
      var emailAddress = $(this).val();

      if (!validateEmail(emailAddress) && emailAddress != "") {
        $(this).addClass("alert-danger");
        $(this).attr("placeholder", "Enter valid email");
      }
    });

    $("#contactemail").keyup(function (event) {
      $(this).removeClass();
      if (event.keyCode == 13) { $("#addcontact").click(); }
    });

    $("#existingcustomers").change(function (event) {
      var selectedValue = $(this).val();

      if (selectedValue != "") {
        // TO DO: get the customer details from the DB and populate the below values as well as the Contacts table grid
        $("#customername").attr("disabled", "disabled");
        $("#customercontactno").attr("disabled", "disabled");
        $("#customeraccountno").attr("disabled", "disabled");
        $("#customermobileno").attr("disabled", "disabled");
        $("#customeremail").attr("disabled", "disabled");
      } else {
        $("#customername").removeAttr("disabled");
        $("#customercontactno").removeAttr("disabled");
        $("#customeraccountno").removeAttr("disabled");
        $("#customermobileno").removeAttr("disabled");
        $("#customeremail").removeAttr("disabled");
      }

    });

    $("#existingcontacts").change(function (event) {
      var selectedValue = $(this).val();

      if (selectedValue != "") {
        // TO DO: get the customer details from the DB and populate the below values as well as the Contacts table grid
        $("#contactname").attr("disabled", "disabled");
        $("#contactno").attr("disabled", "disabled");
        $("#contactemail").attr("disabled", "disabled");
        $("#addcontact").attr("disabled", "disabled");
      } else {
        $("#contactname").removeAttr("disabled");
        $("#contactno").removeAttr("disabled");
        $("#contactemail").removeAttr("disabled");
        $("#addcontact").removeAttr("disabled");
      }

    });

    $("#addcontact").click(function () {
      $("#validbuttons").html("");

      var contactname = $("#contactname").val();
      var contactno = $("#contactno").val();
      var contactemail = $("#contactemail").val();

      if (!validContactForm()) return;

      var exists = false;
      $.each(order.customerContacts, function (index, contact) {

        if (contact.contactname.toUpperCase() === contactname.toUpperCase()) {
          $("#validbuttons").html("Please select " + contactname + " from the available contacts");
          exists = true;
          return;
        }

      });
      if (exists) return;

      order.addContacts.splice(0, 1);
      order.addContacts.push(
        {
          "contactname": contactname, "contactno": contactno, "contactemail": contactemail,
        });

      $("#divcontacts").show();
      var grid = $("#contacts tbody").html("");
      grid.append("<tr>");
      grid.append("<td>" + contactname + "</td>");
      grid.append("<td align='center'>" + contactno + "</td>");
      grid.append("<td>" + contactemail + "</td>");
      grid.append("<td><i class='glyphicon glyphicon-trash' onclick='removeContact()'></i></td>");
      grid.append("</tr>");

      $("#contactname").val("");
      $("#contactno").val("");
      $("#contactemail").val("");
      $("#contactname").focus();

    });

    function removeContact() {
      $("#contacts tbody").html("");
    }

    function validContactForm() {
      var valid = true;
      var contactname = $("#contactname").val();
      var contactno = $("#contactno").val();
      var contactemail = $("#contactemail").val();

      $("#contactno").removeClass();
      $("#contactname").removeClass();

      if (contactname == "") { $("#contactname").addClass("alert-danger"); valid = false; }
      if (contactno == "") { $("#contactno").addClass("alert-danger"); valid = false; }
      if (contactemail != "" && (!validateEmail(contactemail))) { valid = false; }

      return valid;
    }

    $("#done").click(function () {
      $("#validbuttons").html("");

      var customername = $("#customername").val();
      var customercontactno = $("#customercontactno").val();
      var customeremail = $("#customeremail").val();
      var customeraccountno = $("#customeraccountno").val();
      var customermobileno = $("#customermobileno").val();

      if (!validCustomerForm()) return;

      var exists = false;
      $.each(order.customers, function (index, customer) {

        if (customer.customername.toUpperCase() === customername.toUpperCase()) {
          $("#validbuttons").html("Please select " + customername + " from the available customers");
          exists = true;
          return;
        }

      });
      if (exists) return;

      // if no contact person is selected, confirm with user to use only the customer details
      confirm('No contact is added or selected. Continue?')
    });

    function validCustomerForm() {
      var valid = true;
      var customername = $("#customername").val();
      var customercontactno = $("#customercontactno").val();
      var customeremail = $("#customeremail").val();

      $("#customername").removeClass();
      $("#customercontactno").removeClass();

      if (customername == "") { $("#customername").addClass("alert-danger"); valid = false; }
      if (customercontactno == "") { $("#customercontactno").addClass("alert-danger"); valid = false; }
      if (customeremail != "" && (!validateEmail(customeremail))) {  valid = false; }

      return valid;
    }
  </script>
}
