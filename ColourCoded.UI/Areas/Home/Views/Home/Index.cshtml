@model ColourCoded.UI.Areas.Home.Models.HomeViewModel;

@{
  ViewData["Title"] = "Home";
  Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
  table thead tr td {
    background-color: lightgray;
    width: 100px;
  }

  table thead tr td:first-child {
    background-color: lightgray;
    width: 150px;
  }

  input[type=button] {
    width: 100px;
  }

  .validationLabel {
    color: red;
    width: 150px;
    font-size: 11px;
  }

</style>

<h3>Home</h3>
<br />
<h4>Create a Quote in 5 easy steps:</h4>
<br />
<ol>
  <li>Add Order Detail</li>
  <li>Add Customer Detail [Optional]</li>
  <li>Add Delivery Address Detail [Optional]</li>
  <li>Add My Company Detail [Optional]</li>
  <li>@Html.ActionLink("Create Quote Now...", "Index", "Orders", new { area = "Orders" })</li>
</ol>
<br />
@if (Model.Orders.Count > 0)
{
  <h4>Your recent orders:</h4>

  <table id="orders">
    <thead>
      <tr>
        <td>OrderNo</td>
        <td>Customer</td>
        <td>DeliveryDate</td>
        <td>Total</td>
      </tr>
    </thead>
    <tbody>
      @foreach (var order in Model.Orders)
      {
        <tr>
          <td data-orderId="@order.OrderId">@order.OrderNo</td>
          <td>@order.CustomerName</td>
          <td>@order.DeliveryDate</td>
          <td>@order.Total</td>
        </tr>
      }
    </tbody>
  </table>
  <br />
  <div>
    Start: <input type="date" id="ordersFromDate" min="2018-01-01" max="2018-12-31" />&nbsp;End: <input type="date" id="ordersToDate" min="2018-01-01" max="2018-12-31" />&nbsp;<input id="filter" type="button" value="Filter" />
  </div>
  <br />
}


@section Scripts
{
  <script>
    $(document).ready(function () {

    });

    $("#filter").click(function () {
      var patternV1 = /(2018)\/([0-9]{2})\/([0-9]{2})/;
      var patternV2 = /(2018)-([0-9]{2})-([0-9]{2})/;

      var startDate = $("#ordersFromDate").val();
      var endDate = $("#ordersToDate").val();

      if (patternV1.test(startDate) || patternV2.test(startDate)) {

        if (patternV1.test(endDate) || patternV2.test(endDate)) {
          
          $.ajax({
            url: 'https://www.ccinvoice.com' + '@Url.Action("GetUserOrdersByPeriod", "Home")',
            data: { startDate: startDate, endDate: endDate },
            type: 'POST',
            error: function (xhr, error, ajax) {
              showErrorHtml(jQuery.parseJSON(xhr.responseText));
            }
          });

        }
      }

    });
  </script>
}